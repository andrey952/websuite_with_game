<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Chart.js -->
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fafafa;
        }

        button {
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }

        button:hover {
            transform: scale(1.1); /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        div#results {
            margin-top: 30px;
            font-weight: bold;
        }
    </style>
</head>
<body>



<div class="container">
    <h1 class="mb-4">–ò–≥—Ä–∞ "–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞"</h1>

    <!-- –§–æ—Ä–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ -->
    <div class="buttons-container">
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="rock"/>
            <button type="submit" class="btn btn-outline-dark">üß± –ö–∞–º–µ–Ω—å</button>
        </form>
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="paper"/>
            <button type="submit" class="btn btn-outline-dark">üìÑ –ë—É–º–∞–≥–∞</button>
        </form>
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="scissors"/>
            <button type="submit" class="btn btn-outline-dark">‚úÇ –ù–æ–∂–Ω–∏—Ü—ã</button>
        </form>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã -->
    <div th:if="${result != null}" class="mt-4">
        <h2>–í—ã –≤—ã–±—Ä–∞–ª–∏: <span th:text="${playerChoice}"></span></h2>
        <h2>–ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–±—Ä–∞–ª: <span th:text="${computerChoice}"></span></h2>
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç: <span th:text="${result}"></span></h2>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="score" data-score='{"wins": "${score.wins}", "losses": "${score.losses}", "ties": "${score.ties}"}'></div>
    <table class="table mt-4">
        <thead>
        <tr>
            <th scope="col">–ü–æ–±–µ–¥—ã</th>
            <th scope="col">–ü–æ—Ä–∞–∂–µ–Ω–∏—è</th>
            <th scope="col">–ù–∏—á—å–∏</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${score.wins ?: 0}"></td>
            <td th:text="${score.losses ?: 0}"></td>
            <td th:text="${score.ties ?: 0}"></td>
        </tr>
        </tbody>
    </table>



    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <a href="/" class="btn btn-secondary mb-3">–ù–∞–∑–∞–¥</a>

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ —Å—á—ë—Ç–∞ -->
    <form action="/game/reset" method="post">
        <button type="submit" class="btn btn-danger">–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç</button>
    </form>
</div>


<!-- –ö–∞–Ω–≤–∞—Å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
<canvas id="statsChart" width="10" height="10"></canvas>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function drawStatsChart() {
            // –ò—â–µ–º –∫–∞–Ω–≤–∞—Å, –∫—É–¥–∞ –±—É–¥–µ–º —Ä–∏—Å–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫
            const ctx = document.getElementById('statsChart').getContext('2d');

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            const winsCell = document.querySelector('table tbody tr td:nth-child(1)');
            const lossesCell = document.querySelector('table tbody tr td:nth-child(2)');
            const tiesCell = document.querySelector('table tbody tr td:nth-child(3)');

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–∞
            const wins = Number(winsCell.textContent.trim());
            const losses = Number(lossesCell.textContent.trim());
            const ties = Number(tiesCell.textContent.trim());

            // –ì–æ—Ç–æ–≤–∏–º –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            const dataArray = [wins, losses, ties];

            // –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫
            new Chart(ctx, {
                type: 'bar', // –°—Ç–æ–ª–±—á–∞—Ç—ã–π –≥—Ä–∞—Ñ–∏–∫
                data: {
                    labels: ['–ü–æ–±–µ–¥—ã', '–ü–æ—Ä–∞–∂–µ–Ω–∏—è', '–ù–∏—á—å–∏'], // –ú–µ—Ç–∫–∏ –ø–æ –æ—Å–∏ X
                    datasets: [{
                        label: '–ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–∞–Ω–Ω—ã—Ö
                        data: dataArray, // –°–∞–º–∏ –¥–∞–Ω–Ω—ã–µ
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)', // –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–æ–±–µ–¥
                            'rgba(255, 99, 132, 0.6)', // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π
                            'rgba(255, 206, 86, 0.6)'  // –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è –Ω–∏—á—å–∏—Ö
                        ],
                        borderWidth: 1
                    }]
                },
                options: {

                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true // –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ —à–∫–∞–ª—ã Y —Ä–∞–≤–Ω–∞ –Ω—É–ª—é
                        }
                    }
                }
            }); // <-- –≠—Ç–∞ –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –±—ã–ª–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ —Ä–∞–Ω–µ–µ
        }

        // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        drawStatsChart();
    });
</script>
</body>
</html>