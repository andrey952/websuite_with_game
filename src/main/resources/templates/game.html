<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fafafa;
        }

        button {
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }

        button:hover {
            transform: scale(1.1); /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }

        div#results {
            margin-top: 30px;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4">–ò–≥—Ä–∞ "–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞"</h1>

    <!-- –§–æ—Ä–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ -->
    <div class="buttons-container">
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="rock"/>
            <button type="submit" class="btn btn-outline-dark">üß± –ö–∞–º–µ–Ω—å</button>
        </form>
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="paper"/>
            <button type="submit" class="btn btn-outline-dark">üìÑ –ë—É–º–∞–≥–∞</button>
        </form>
        <form action="/game/play" method="get">
            <input type="hidden" name="choice" value="scissors"/>
            <button type="submit" class="btn btn-outline-dark">‚úÇ –ù–æ–∂–Ω–∏—Ü—ã</button>
        </form>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏–≥—Ä—ã -->
    <div th:if="${result != null}" class="mt-4">
        <h2>–í—ã –≤—ã–±—Ä–∞–ª–∏: <span th:text="${playerChoice}"></span></h2>
        <h2>–ö–æ–º–ø—å—é—Ç–µ—Ä –≤—ã–±—Ä–∞–ª: <span th:text="${computerChoice}"></span></h2>
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç: <span th:text="${result}"></span></h2>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div id="score" data-score='{"wins": "${score.wins}", "losses": "${score.losses}", "ties": "${score.ties}"}'></div>
    <table class="table mt-4">
        <thead>
        <tr>
            <th scope="col">–ü–æ–±–µ–¥—ã</th>
            <th scope="col">–ü–æ—Ä–∞–∂–µ–Ω–∏—è</th>
            <th scope="col">–ù–∏—á—å–∏</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td th:text="${score.wins ?: 0}"></td>
            <td th:text="${score.losses ?: 0}"></td>
            <td th:text="${score.ties ?: 0}"></td>
        </tr>
        </tbody>
    </table>

    <!-- –ö–∞–Ω–≤–∞—Å –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <canvas id="statsChart" width="400" height="200"></canvas>

    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <a href="/" class="btn btn-secondary mb-3">–ù–∞–∑–∞–¥</a>

    <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ —Å—á—ë—Ç–∞ -->
    <form action="/game/reset" method="post">
        <button type="submit" class="btn btn-danger">–°–±—Ä–æ—Å–∏—Ç—å —Å—á—ë—Ç</button>
    </form>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –µ–¥–∏–Ω–æ–∂–¥—ã, –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–æ–±—ã—Ç–∏—é submit
    function drawStatsChart() {
        const ctx = document.getElementById('statsChart').getContext('2d');
        const score = JSON.parse(document.querySelector('#score').dataset.score);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['–ü–æ–±–µ–¥—ã', '–ü–æ—Ä–∞–∂–µ–Ω–∏—è', '–ù–∏—á—å–∏'],
                datasets: [{
                    label: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                    data: [score.wins, score.losses, score.ties],
                    backgroundColor: [
                        '#4CAF50', // –ó–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–æ–±–µ–¥
                        '#FF5733', // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π
                        '#FFC300'  // –ñ—ë–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è –Ω–∏—á—å–∏—Ö
                    ]
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞–∂–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    drawStatsChart();

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    document.querySelectorAll('.buttons-container form').forEach(form => {
        form.addEventListener('submit', async () => {
            await fetch('/game/play?' + new URLSearchParams(new FormData(form)));
            location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        });
    });
</script>

</body>
</html>